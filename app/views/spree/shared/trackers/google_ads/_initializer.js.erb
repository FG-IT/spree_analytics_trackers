<% if defined?(gads_enabled?) && gads_enabled? %>
<% conversion_id = gads_tracker.analytics_id.include?('AW-') ? gads_tracker.analytics_id : "AW-#{gads_tracker.analytics_id}" %>
<!-- Google Ads Conversion Tracking -->
<script type="text/javascript" data-turbolinks-eval="false">
/* Make sure gtag exists */
if (typeof gtag === 'undefined') {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
}

gtag('js', new Date());
gtag('config', '<%= conversion_id %>', {'allow_enhanced_conversions': true});

// Only execute load script once
window.addEventListener('turbolinks:load', function () {
  let src = "https://www.googletagmanager.com/gtag/js?id=<%= conversion_id %>";
  if (!isGTagExist()) {
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.defer=true; g.src=src; s.parentNode.insertBefore(g,s);
  }
});

function isGTagExist() {
  return document.querySelector('script[src^="https://www.googletagmanager.com/gtag/js"]') !== null;
}
</script>

<!-- End Google Ads Conversion Tracking -->
<% end %>
