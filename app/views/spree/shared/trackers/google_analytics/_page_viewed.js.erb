<% if (defined?(ga_enabled?) && ga_enabled?) || (defined?(ga4_enabled?) && ga4_enabled?) %>
<script type="text/javascript" data-turbolinks-eval="false">
window.addEventListener('turbolinks:load', function () {
  if (typeof gtag !== 'undefined') {
    gtag('event', 'page_view');
  }
});
</script>

<% if controller_name == 'orders' and action_name == 'edit' %>
<% fa_event = 'view_cart' %>
<% if defined?(ga_enabled?) && ga_enabled? %>
<script type="text/javascript">
if (typeof gtag !== 'undefined') {
  gtag('event', '<%= fa_event %>', {
      'send_to': '<%= ga_tracker.analytics_id %>',
      'currency': '<%=current_currency %>',
      <% if @order %>
      'items': [
          <% @order.line_items.each do |item| %>
          {
              'id': '<%= item.variant_id %>',
              'quantity': '<%= item.quantity %>',
              'name': '<%= item.product.name %>',
              'google_business_vertical': 'retail',
              'currency': "<%= item.currency %>",
              'price': '<%= item.price %>'
          },
          <% end %>
      ],
      <% end %>
  });
}
</script>
<% end %>

<% if defined?(ga4_enabled?) && ga4_enabled? %>
<script type="text/javascript">
if (typeof gtag !== 'undefined') {
  gtag('event', '<%= fa_event %>', {
      'send_to': '<%= ga4_tracker.analytics_id %>',
      'currency': '<%=current_currency %>',
      'value': '<%= @order&.total&.to_f || 0 %>',
      <% if @order %>
      'items': [
          <% @order.line_items&.each do |item| %>
          {
              'item_id': '<%= item.variant_id %>',
              'item_name': '<%= item.product.name %>',
              'price': '<%= item.price %>',
              'quantity': '<%= item.quantity %>',
          },
          <% end %>
      ],
      <% end %>
  });
}
</script>
<% end %>

<% end %>

<% end %>
